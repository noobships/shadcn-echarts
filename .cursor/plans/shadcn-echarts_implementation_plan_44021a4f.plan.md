---
name: shadcn-echarts implementation plan
overview: Create a TypeScript package and shadcn/ui registry for Apache ECharts charts styled to match shadcn/ui's design language, with full dark/light mode support and excellent developer experience.
todos:
  - id: setup-project
    content: Initialize pnpm workspace, TypeScript config, and tsdown build setup
    status: completed
  - id: create-theme-system
    content: Build theme system that converts shadcn/ui CSS variables to ECharts themes with dark/light mode support
    status: completed
  - id: enhance-theme-development
    content: Enhance theme system with comprehensive chart type support, improved color conversion, and better theme registration
    status: completed
  - id: build-core-components
    content: Create base Chart component and React wrapper with ECharts integration
    status: completed
  - id: create-chart-components
    content: "Build typed React components for ALL 34+ ECharts chart types (2D: Line, Bar, Pie, Scatter, Area, Map, Candlestick, Radar, Boxplot, Heatmap, Graph, Lines, Tree, Treemap, Sunburst, Parallel, Sankey, Funnel, Gauge, PictorialBar, ThemeRiver, Calendar, Matrix, Chord, Custom; 3D/WebGL: Globe3D, Bar3D, Scatter3D, Surface3D, Map3D, Lines3D, Line3D, ScatterGL, LinesGL, GraphGL)"
    status: completed
  - id: setup-registry
    content: Create shadcn/ui registry structure and registry.json configuration
    status: completed
  - id: create-registry-items
    content: Create registry items for ALL 34+ chart types following shadcn/ui schema - ensure complete coverage with no chart types skipped
    status: completed
  - id: configure-build
    content: Set up tsdown config for multi-format output (ESM/CJS) and package.json exports
    status: completed
  - id: add-documentation
    content: Write comprehensive README, API docs, and usage examples
    status: pending
isProject: false
---

# shadcn-echarts Implementation Plan

## Project Overview

Build a comprehensive TypeScript package that provides Apache ECharts charts styled to match shadcn/ui's minimalistic design language, with seamless dark/light mode support. The package will be available both as an npm package and as a shadcn/ui registry for maximum flexibility.

## Architecture Overview

```
shadcn-echarts/
├── src/
│   ├── core/              # Core ECharts wrapper and theme system
│   ├── themes/            # shadcn/ui-inspired ECharts themes
│   ├── components/        # React components for each chart type
│   ├── hooks/             # React hooks for theme management
│   ├── utils/             # Utility functions
│   └── index.ts           # Main package exports
├── registry/              # shadcn/ui registry items
│   └── [style]/          # Registry items organized by style
├── dist/                  # Built output (tsdown)
├── tsdown.config.ts       # Build configuration
└── package.json
```

## Implementation Phases

### Phase 1: Core Package Setup ✅ COMPLETED

**1.1 Project Initialization** ✅

- ✅ Initialize pnpm workspace
- ✅ Set up TypeScript configuration with strict mode
- ✅ Configure tsdown for library bundling (ESM + CJS formats)
- ✅ Set up package.json with proper exports field (auto-generated by tsdown)
- ✅ Created .gitignore and .npmignore
- Reference: [tsdown getting-started.md](docs/tsdown/guide/getting-started.md), [package-exports.md](docs/tsdown/options/package-exports.md)

**1.2 ECharts Integration** ✅

- ✅ Set up tree-shakeable imports structure
- ✅ Create core wrapper module for ECharts initialization (`src/core/chart.ts`)
- ✅ Add SSR utilities (`src/core/ssr.ts`)
- ✅ Create comprehensive TypeScript types using ComposeOption pattern (`src/core/types.ts`)
- Reference: [ECharts import-echarts.md](docs/echarts/basics/import-echarts.md)

**1.3 Theme System Foundation** ✅

- ✅ Create theme builder utilities based on shadcn/ui color system (`src/themes/builder.ts`)
- ✅ Map shadcn/ui CSS variables (oklch colors) to ECharts theme format
- ✅ Create base theme structure for light and dark modes
- ✅ Implement theme registration system (`src/themes/registry.ts`)
- ✅ Add oklch to hex color conversion
- ✅ Create theme type definitions (`src/themes/types.ts`)
- Reference: [shadcn/ui theming.md](docs/shadcn-ui/get-started/theming.md), [ECharts style.md](docs/echarts/concepts/style.md), [ECharts 6 dark mode](docs/echarts/basics/what's -new/echarts-6-features.md)

**1.4 SSR Support** ✅

- ✅ Implement server-side SVG rendering utilities
- ✅ Add SSR detection helpers
- ✅ Create renderToSVGString functions with theme support

**1.5 React Hooks** ✅

- ✅ Create `useEChartsTheme()` hook for theme detection
- ✅ Implement automatic dark mode detection
- ✅ Add theme change watching functionality

### Phase 2: Theme Development ✅ COMPLETED

**2.1 shadcn/ui Theme Mapping** ✅

- ✅ Extract color palette from shadcn/ui CSS variables:
  - `--chart-1` through `--chart-5` for series colors
  - `--background`, `--foreground` for chart background/text
  - `--muted`, `--muted-foreground` for secondary elements
  - `--border` for grid lines and borders
  - `--primary`, `--primary-foreground` for emphasis
- ✅ Create theme JSON objects for both light and dark modes
- ✅ Enhanced color extraction with support for hex, rgb/rgba, and oklch formats
- Reference: [shadcn/ui theming.md lines 93-163](docs/shadcn-ui/get-started/theming.md)

**2.2 ECharts Theme Registration** ✅

- ✅ Create theme registration system that:
  - Reads CSS variables from DOM (or accepts theme object)
  - Converts oklch colors to hex/rgb for ECharts using browser APIs when available
  - Registers themes with `echarts.registerTheme()`
  - Supports dynamic theme switching via `chart.setTheme()`
- ✅ Improved dark mode detection with element parameter support
- ✅ Enhanced `watchThemeChanges()` with proper cleanup and disposal checks
- ✅ Added `registerThemeFromColors()` for SSR/custom themes
- ✅ Added `registerTheme()` for direct theme object registration
- Reference: [ECharts theme registration](docs/echarts/concepts/style.md#theme), [ECharts 6 dynamic switching](docs/echarts/basics/what's -new/echarts-6-features.md)

**2.3 Theme Builder Integration** ✅

- ✅ Enhanced oklch to hex conversion with browser `getComputedStyle()` API fallback
- ✅ Comprehensive theme builder supporting all ECharts chart types:
  - Line, Bar, Pie, Scatter, Radar, Boxplot, Parallel, Sankey, Funnel, Gauge, Candlestick, Graph, Map/Geo
- ✅ Component styling for toolbox, timeline, visualMap, dataZoom, markPoint, markLine, markArea
- ✅ Axis styling for categoryAxis, valueAxis, logAxis, timeAxis
- ✅ Improved tooltip contrast for dark/light modes
- ✅ All type checks and linting pass
- Reference: [echarts-theme-builder](https://github.com/apache/echarts-theme-builder)

### Phase 3: React Components ✅ COMPLETED

**3.1 Core Chart Component** ✅

- ✅ Created base `<Chart />` React component that:
  - Accepts ECharts option as prop with full TypeScript typing
  - Handles ECharts instance lifecycle (init, dispose, resize)
  - Supports responsive resizing with ResizeObserver and window resize listener
  - Integrates with theme system (automatic detection and manual override)
  - Supports forward ref for accessing chart instance
  - Handles loading states
  - Manages event handlers with proper cleanup
  - Supports SSR mode
  - Explicit return types for isolated declarations compatibility
- Reference: [ECharts chart-container.md](docs/echarts/concepts/chart-container.md)

**3.2 Chart Type Components** ✅

✅ Created typed React components for ALL ECharts chart types. Based on [ECharts examples.md](docs/echarts/examples/examples.md), all 36 chart types are implemented:

**2D Chart Types (26 components):** ✅

- ✅ `<LineChart />` - Line charts
- ✅ `<BarChart />` - Bar charts
- ✅ `<PieChart />` - Pie charts
- ✅ `<ScatterChart />` - Scatter plots
- ✅ `<AreaChart />` - Area charts (line with areaStyle)
- ✅ `<MapChart />` - Map charts
- ✅ `<GeoChart />` - GEO charts (alias for MapChart)
- ✅ `<CandlestickChart />` - Candlestick charts
- ✅ `<RadarChart />` - Radar charts
- ✅ `<BoxplotChart />` - Boxplot charts
- ✅ `<HeatmapChart />` - Heatmap charts
- ✅ `<GraphChart />` - Graph/network charts
- ✅ `<LinesChart />` - Lines (flow/path) charts
- ✅ `<TreeChart />` - Tree charts
- ✅ `<TreemapChart />` - Treemap charts
- ✅ `<SunburstChart />` - Sunburst charts
- ✅ `<ParallelChart />` - Parallel coordinate charts
- ✅ `<SankeyChart />` - Sankey diagrams
- ✅ `<FunnelChart />` - Funnel charts
- ✅ `<GaugeChart />` - Gauge charts
- ✅ `<PictorialBarChart />` - Pictorial bar charts
- ✅ `<ThemeRiverChart />` - Theme river charts
- ✅ `<CalendarChart />` - Calendar charts
- ✅ `<MatrixChart />` - Matrix charts
- ✅ `<ChordChart />` - Chord diagrams
- ✅ `<CustomChart />` - Custom series (renderItem-based)

**3D/WebGL Chart Types (10 components):** ✅

- ✅ `<Globe3DChart />` - 3D Globe charts
- ✅ `<Bar3DChart />` - 3D Bar charts
- ✅ `<Scatter3DChart />` - 3D Scatter charts
- ✅ `<Surface3DChart />` - 3D Surface charts
- ✅ `<Map3DChart />` - 3D Map charts
- ✅ `<Lines3DChart />` - 3D Lines charts
- ✅ `<Line3DChart />` - 3D Line charts
- ✅ `<ScatterGLChart />` - WebGL Scatter charts
- ✅ `<LinesGLChart />` - WebGL Lines charts
- ✅ `<GraphGLChart />` - WebGL Graph charts

**Component Features:** ✅

- ✅ Proper TypeScript types using ECharts' ComposeOption pattern
- ✅ Chart-specific props with full type safety
- ✅ Tree-shakeable ECharts imports (only import required chart types and components)
- ✅ Support theme switching via theme prop or automatic detection
- ✅ Handle responsive resizing through base Chart component
- ✅ Support all ECharts features (tooltip, legend, dataZoom, visualMap, etc.)
- ✅ Explicit return types (React.JSX.Element) for isolated declarations
- ✅ Proper component registration with required ECharts modules
- ✅ Lazy registration pattern to avoid duplicate registrations

**Component Organization:** ✅

- ✅ 2D charts organized in `src/components/charts/2d/` (26 components)
- ✅ 3D/WebGL charts organized in `src/components/charts/3d/` (10 components)
- ✅ Index files created for easy imports (`2d/index.ts`, `3d/index.ts`, `charts/index.ts`)
- ✅ All components exported from main `src/index.ts`
- ✅ Tree-shaking verified and working
- Reference: [ECharts examples.md](docs/echarts/examples/examples.md) for complete chart type list

**3.3 Theme Hook** ✅

- ✅ `useEChartsTheme()` hook already created in Phase 1 that:
  - Detects system dark mode preference
  - Watches for theme changes (MutationObserver + MediaQuery)
  - Returns current theme name and mode
  - Can be used to sync with shadcn/ui theme
  - Integrated with all chart components for automatic theme detection
- Reference: [ECharts 6 dark mode detection](docs/echarts/basics/what's -new/echarts-6-features.md#3-dark-mode-support)

**Phase 3 Summary:**

- ✅ Base Chart component with full lifecycle management
- ✅ 36 chart components (26 2D + 10 3D/WebGL) - complete coverage
- ✅ All components properly typed with TypeScript
- ✅ Tree-shakeable imports for optimal bundle size
- ✅ Theme integration with automatic dark/light mode detection
- ✅ Responsive resizing support
- ✅ All type checks and linting pass (0 errors, 0 warnings)
- ✅ Build completes successfully
- ✅ Components organized in logical directory structure
- ✅ All exports properly configured for tree-shaking

### Phase 4: TypeScript Types ✅ COMPLETED

**4.1 Type Definitions** ✅

- ✅ Create comprehensive TypeScript types:
  - ✅ Chart component props (BaseChartProps with proper typing)
  - ✅ Theme configuration types (already in themes/types.ts)
  - ✅ Utility function types (LoadingOption, EChartsEventHandler)
- ✅ Leverage ECharts' built-in types where possible
- ✅ Added MatrixChartOption and GeoChartOption types
- ✅ Enhanced BaseChartProps with proper types (CSSProperties, LoadingOption, EChartsEventHandler)
- ✅ Added union types for type narrowing (ChartOption2D, ChartOption3D, ChartOption)
- Reference: [ECharts TypeScript types](docs/echarts/basics/import-echarts.md#creating-an-option-type-in-typescript)

**4.2 Type Exports** ✅

- ✅ Export all types from main package entry (via src/index.ts)
- ✅ Ensure types work with tree-shaking (type-only exports)
- ✅ Provide type helpers for custom chart options (union types)
- ✅ Updated MatrixChart component to use MatrixChartOption
- ✅ All types properly documented with JSDoc comments
- ✅ TypeScript compilation passes with 0 errors
- ✅ oxlint passes with 0 warnings and 0 errors

### Phase 5: shadcn/ui Registry ✅ COMPLETED

**5.1 Registry Structure** ✅

- ✅ Create `registry/` directory following shadcn/ui conventions
- ✅ Organize by style (`registry/default/`)
- ✅ Each chart type gets its own registry item
- Reference: [shadcn/ui registry getting-started.md](docs/shadcn-ui/registery/getting-started.md)

**5.2 Registry Items** ✅

✅ Created registry items for ALL 36 chart types (complete coverage):

**2D Chart Registry Items (26 items):** ✅

- ✅ `line-chart`, `bar-chart`, `pie-chart`, `scatter-chart`, `area-chart`
- ✅ `map-chart`, `geo-chart`, `candlestick-chart`, `radar-chart`, `boxplot-chart`
- ✅ `heatmap-chart`, `graph-chart`, `lines-chart`, `tree-chart`, `treemap-chart`
- ✅ `sunburst-chart`, `parallel-chart`, `sankey-chart`, `funnel-chart`, `gauge-chart`
- ✅ `pictorial-bar-chart`, `theme-river-chart`, `calendar-chart`, `matrix-chart`, `chord-chart`
- ✅ `custom-chart`

**3D/WebGL Chart Registry Items (10 items):** ✅

- ✅ `globe-3d-chart`, `bar-3d-chart`, `scatter-3d-chart`, `surface-3d-chart`, `map-3d-chart`
- ✅ `lines-3d-chart`, `line-3d-chart`, `scatter-gl-chart`, `lines-gl-chart`, `graph-gl-chart`

For each registry item, created:

- ✅ Component file in `registry/default/[chart-name]/[chart-name].tsx` (36 files)
- ✅ Registry item JSON definition with proper metadata (36 files)
- ✅ Dependencies listed (`@shadcn/echarts`, `echarts@^6.0.0`, `react@>=18.0.0`)
- ✅ All components import from `@shadcn/echarts` package
- ✅ All components properly typed with TypeScript
- Reference: [registry-item.json.md](docs/shadcn-ui/registery/registery-item.json.md)

**Registry Item Structure:** ✅

```
registry/
├── default/
│   ├── line-chart/
│   │   ├── line-chart.tsx
│   │   └── line-chart.json
│   ├── bar-chart/
│   ├── pie-chart/
│   └── ... (all 36 chart types)
```

**Verification:** ✅ All 36 chart types created (26 2D + 10 3D/WebGL). Cross-referenced with component exports to ensure completeness.

**5.3 Registry Configuration** ✅

- ✅ Create `registry.json` at root with all 36 items
- ✅ Define all registry items with proper metadata (name, type, title, description, dependencies, files)
- ✅ Set up build script using `shadcn build` command (already in package.json)
- ✅ Registry JSON properly formatted and validated
- Reference: [registry.json.md](docs/shadcn-ui/registery/registery.json.md), [getting-started.md build section](docs/shadcn-ui/registery/getting-started.md#build-your-registry)

**5.4 Registry Dependencies** ✅

- ✅ List `echarts@^6.0.0` as dependency in all registry items
- ✅ List `@shadcn/echarts` as dependency (the package itself)
- ✅ List `react@>=18.0.0` as dependency
- ✅ All dependencies properly specified in registry item JSON files
- Reference: [registry-item.json dependencies](docs/shadcn-ui/registery/registery-item.json.md#dependencies)

**5.5 TypeScript Fixes** ✅

- ✅ Fixed all TypeScript errors in registry files:
  - Added explicit React imports to resolve "React refers to a UMD global" errors
  - Updated all registry components to use exported props types from `@shadcn/echarts` instead of redefining them
  - Simplified component implementations to use spread props pattern
- ✅ All 36 registry files now pass TypeScript type checking with 0 errors
- ✅ All registry files follow consistent pattern and best practices
- ✅ Type safety ensured by using package-exported types

### Phase 6: Build & Distribution ✅ COMPLETED

**6.1 tsdown Configuration** ✅

- ✅ Configured tsdown with entry aliases for proper output structure:
  - Entry points: `index`, `hooks/index`, `themes/index`
  - Outputs correctly to `dist/index.js`, `dist/hooks/index.js`, `dist/themes/index.js`
- ✅ ESM and CJS output formats configured
- ✅ TypeScript declaration files enabled (`dts: true`)
- ✅ Tree-shaking enabled (`treeshake: true`)
- ✅ No CSS files needed (ECharts handles styling via themes)
- ✅ Source maps enabled for debugging
- ✅ External dependencies properly configured (react, react-dom, echarts)
- Reference: [tsdown config options](docs/tsdown/options/)

**6.2 Package Configuration** ✅

- ✅ Package.json exports properly configured:
  - Main entry: `./dist/index.js` (ESM) and `./dist/index.cjs` (CJS)
  - Hooks entry: `./dist/hooks/index.js` and `./dist/hooks/index.cjs`
  - Themes entry: `./dist/themes/index.js` and `./dist/themes/index.cjs`
  - All with proper TypeScript type declarations
- ✅ Peer dependencies configured: `react >=18.0.0`, `echarts >=6.0.0`
- ✅ TypeScript types entry points configured
- ✅ `sideEffects: false` for optimal tree-shaking
- ✅ Files array includes `dist`, `registry`, and `README.md`
- Reference: [tsdown package-exports.md](docs/tsdown/options/package-exports.md)

**6.3 Build Scripts** ✅

- ✅ `build`: Build package with tsdown
- ✅ `dev`: Watch mode for development (`tsdown --watch`)
- ✅ `type-check`: TypeScript type checking (`tsc --noEmit`)
- ✅ `lint`: oxlint linting
- ✅ `registry:build`: Build registry JSON files (`shadcn build`)
- ✅ All scripts tested and working correctly
- Reference: [tsdown watchmode.md](docs/tsdown/options/watchmode.md)

**Verification:** ✅

- ✅ TypeScript compilation: 0 errors
- ✅ oxlint: 0 warnings, 0 errors
- ✅ Build completes successfully
- ✅ All output files in correct locations
- ✅ TypeScript declarations generated correctly
- ✅ Package exports match actual output files

### Phase 7: Verification & Testing

**7.1 Chart Coverage Verification**

- Create a checklist of all 34+ chart types from [ECharts examples.md](docs/echarts/examples/examples.md)
- Verify each chart type has:
  - React component implementation
  - Registry item created
  - TypeScript types defined
  - Basic example working
- Cross-reference with ECharts official examples to ensure nothing is missed
- Test each chart type in both light and dark modes

**7.2 Component Testing**

- Unit tests for each chart component
- Theme switching tests
- Responsive behavior tests
- Tree-shaking verification (ensure unused charts don't bloat bundle)

### Phase 8: Documentation & Examples

**8.1 Package Documentation**

- README with installation and usage
- API documentation for all 34+ chart components
- Theme customization guide
- Dark mode integration guide
- Complete chart type reference

**8.2 Registry Documentation**

- Usage examples for each chart type
- Integration with shadcn/ui projects
- Theme synchronization guide
- Chart type selection guide

**8.3 Examples**

- Create example components showing:
  - Basic chart usage for each type
  - Theme customization
  - Dark mode integration
  - Advanced configurations
  - Chart combinations

## Developer Experience Features

### Package Usage (npm/pnpm install)

```typescript
// Tree-shakeable imports
import { BarChart } from '@shadcn/echarts'
import { useEChartsTheme } from '@shadcn/echarts/hooks'

// Automatic theme detection
function MyChart() {
  const theme = useEChartsTheme() // 'light' | 'dark'
  return <BarChart data={...} />
}
```

### Registry Usage (shadcn CLI)

```bash
# Install a chart component
npx shadcn@latest add https://your-registry.com/r/bar-chart.json

# Component is added to project with proper imports
```

### Theme Integration

- Automatic detection of shadcn/ui theme via CSS variables
- Seamless dark/light mode switching
- Custom theme support via theme prop
- Reference: [ECharts 6 dynamic theme switching](docs/echarts/basics/what's -new/echarts-6-features.md#2-dynamic-theme-switching)

## Key Technical Decisions

1. **Tree-shaking**: Use ECharts modular imports to keep bundle size small
2. **Theme System**: Convert shadcn/ui CSS variables to ECharts theme format at runtime
3. **Type Safety**: Leverage ECharts' TypeScript types with custom composition
4. **Registry Format**: Follow shadcn/ui registry schema exactly for compatibility
5. **Build Tool**: Use tsdown for fast, simple library bundling
6. **Package Manager**: Use pnpm for efficient dependency management

## Success Metrics

- Package installs cleanly via npm/pnpm
- Registry items install via shadcn CLI without errors
- **ALL 34+ chart types are implemented and available** (verified against ECharts examples)
- Charts automatically match shadcn/ui theme
- Dark/light mode works seamlessly
- Bundle size is optimized via tree-shaking
- TypeScript types are comprehensive and accurate
- Zero runtime dependencies beyond echarts and react
- Complete registry coverage - no chart types missing

## References

- **ECharts Documentation**: [docs/echarts/](docs/echarts/)
- **ECharts Examples (Complete Chart List)**: [docs/echarts/examples/examples.md](docs/echarts/examples/examples.md) - **CRITICAL: Contains all 34+ chart types**
- **ECharts Features**: [docs/echarts/features/features.md](docs/echarts/features/features.md) - Lists all supported chart series
- **shadcn/ui Registry**: [docs/shadcn-ui/registery/](docs/shadcn-ui/registery/)
- **tsdown Documentation**: [docs/tsdown/](docs/tsdown/)
- **ECharts Theme Builder**: https://github.com/apache/echarts-theme-builder
- **ECharts 6 Features**: [docs/echarts/basics/what's -new/echarts-6-features.md](docs/echarts/basics/what's -new/echarts-6-features.md)

## Complete Chart Type List (For Verification)

**2D Charts (24):** Line, Bar, Pie, Scatter, Area, GEO/Map, Candlestick, Radar, Boxplot, Heatmap, Graph, Lines, Tree, Treemap, Sunburst, Parallel, Sankey, Funnel, Gauge, PictorialBar, ThemeRiver, Calendar, Matrix, Chord, Custom

**3D/WebGL Charts (10):** 3D Globe, 3D Bar, 3D Scatter, 3D Surface, 3D Map, 3D Lines, 3D Line, Scatter GL, Lines GL, Graph GL

**Total: 34+ chart types** - All must be implemented as React components and registry items.